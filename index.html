<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/Vendor/bootstrap-3.3.7-dist/bootstrap.min.css">
    <link rel="stylesheet" href="css/Vendor/bootstrap-3.3.7-dist/bootstrap-theme.css">
</head>
<body>

<div class="container-fluid menu">
    <div class="row">
        <div class="col-sm-2">
            <div class="btn-group-vertical" role="group" aria-label="...">
                <label for="pencil">Desenho Livre</label>
                <button id="pencil" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Desenhar
                </button>
                <button id="close_pencil" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Fechar Desenho
                </button>
                <button id="save" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-save" aria-hidden="true"></span> Salvar
                </button>
                <button id="open" type="button" class="btn btn-default btn-sm" onclick="document.getElementById('openFileID').click(); return false;">
                    <span class="glyphicon glyphicon-open-file" aria-hidden="true"></span> Abrir
                </button>
                <input id="openFileID" type="file" onchange="openFile(event); this.value=null; return false;" style="display: none;" accept=".fjd">
                <hr>

                <label for="pencil">Polígono Regular</label>
                <button id="regularPolPencil" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span> Desenhar
                </button>
                <input id="radius" type="number" class="form-control" placeholder="Raio">
                <input id="sides" type="number" class="form-control" placeholder="Lados">
                <hr>
                <button id="apagar" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-new-window" aria-hidden="true"></span> Limpar Tudo
                </button>
                <hr>

                <button id="pintar" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-picture" aria-hidden="true"></span> Borda
                </button>
                <input id="cor" type="text" class="form-control" placeholder="Cor" value="#000000">
                <hr>

                <div class="btn-group btn-group-justified">

                    <button id="selecionar" type="button" class="btn btn-default btn-sm">
                        <span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span> Ferramenta de Seleção
                    </button>
                    <button id="remover" type="button" class="btn btn-default btn-sm">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Remover
                    </button>
                </div>
                <hr>
                <button id="translar" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span> Translar
                </button>
            </div>

            <br>
            <label >Escala</label>
            <div class="btn-group col-md-12">
                <button id="escala-plus-x" type="button" class="btn-group">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true">X</span>
                </button>
                <button id="escala-minus-x" type="button" class="btn-group">
                    <span class="glyphicon glyphicon-minus" aria-hidden="true">X</span>
                </button>
                <button id="escala-plus-y" type="button" class="btn-group">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true">Y</span>
                </button>
                <button id="escala-minus-y" type="button" class="btn-group">
                    <span class="glyphicon glyphicon-minus" aria-hidden="true">Y</span>
                </button>
            </div>
            <hr>
            <label >Cisalhamento</label>
            <div class="btn-group col-md-12">
                <button id="cisalhamento-plus" type="button" class="btn-group-sm">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn-group-sm">
                    <span id="cisalhamento-minus" class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                </button>
            </div>
        </div>
        <div class="col-sm-10">
            <canvas id="canvas" width="600" height="600" style="border: 1px solid black;">
            </canvas>
        </div>
    </div>
</div>


<!--IMPORTS-->
<script src="js/vendor/modernizr-2.8.3.min.js"></script>
<script src="js/vendor/jquery-1.12.0.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
<script src="js/plugins.js" type="text/javascript"></script>
<script src="js/Models/Ponto.js"></script>
<script src="js/Models/Poligono.js"></script>
<script src="js/Models/Aresta.js"></script>
<script src="js/Utils.js"></script>
<script src="js/opcoes.js"></script>
<script src="js/main.js"></script>

<script>

    //pegando o canvas
    var canvas = $('#canvas').get(0);
    var context = canvas.getContext('2d');

    startCanvas(canvas); // montando as grids
    //lista de poligonos
    var poligonos = [];
    var ponto = new Ponto();


    //globais
    var opcao = 1;
    var pontos = []; // para manter uma lista de pontos por precaução
    var ponto_temp;
    var arestas = [];
    var started = false;
    var closed = true;
    var selecionado = false;
    var selecionado_index;

    var movendo = false;

    var x_init;
    var y_init;

    var openFile = function(event) {
        var input = event.target;

        var reader = new FileReader();
        reader.onload = function(){
            var text = reader.result;

            var clone = JSON.parse(text);
//            console.log(clone[0]);
            for (let i = 0; i < clone.length; i ++) {
                poligonos.push(new Poligono(
                    clone[i]._arestas, clone[i]._x_max, clone[i]._x_min, clone[i]._y_max, clone[i]._y_min, clone[i]._pontos
                ));
            }

            reeiniciaTela(canvas, poligonos);

        };
        reader.readAsText(input.files[0]);
    };

    canvas.addEventListener('click', ev_mouseclick, false);

    // só pra verificar as coordenadas!
    canvas.addEventListener('auxclick', function (ev) {
        console.log(ev.offsetX, ev.offsetY);
        p = new Ponto(ev.offsetX, ev.offsetY);
    }, false);

    canvas.addEventListener('mousedown', function(e) {
        movendo = true;
        x_init = e.offsetX;
        y_init = e.offsetY;

//        canvas.addEventListener('mousemove', function(e) {
//            if (movendo) {
////                console.log(e.offsetX + " " + e.offsetY)
//            }
//
//            if (opcao == 4) {
//                let x_diff = e.layerX - x_init;
//                let y_diff = e.layerY - y_init;
//
//            console.log(x_diff + ' ' +  y_diff);
////                translar(poligonos[selecionado_index], x_diff, y_diff);
//            }
//        });
    }, false);



    canvas.addEventListener('mouseup', function (ev) {

        movendo = false;
        if (opcao == 4) {
            let x_diff = ev.layerX - x_init;
            let y_diff = ev.layerY - y_init;

//            console.log(x_diff + ' ' +  y_diff);
            translar(poligonos[selecionado_index], x_diff, y_diff);
        }
    });

</script>

</body>
</html>
